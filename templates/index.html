<!DOCTYPE html>
<html lang="en">

<head>
	<base target="_top">
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">

	<title>Quick Start - Leaflet</title>

	<!--<link rel="shortcut icon" type="image/x-icon" href="docs/images/favicon.ico" /> -->
	<link rel="stylesheet" href="/static/style.css">

	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>


	<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
		integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
	<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
		integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
	<script src="https://cdn.jsdelivr.net/npm/leaflet.path.drag@0.0.6/src/Path.Drag.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/@turf/turf@7/turf.min.js"></script>
</head>


<body>
	<div id="map"></div>

	{% block scripts %}
	<script>
		// 1 Map initialization
		var map = L.map('map').setView([52.518611, 13.408333], 10);

		// 2a) Add backggroud map: Luftbilder 1989
		var luftbilder1989 = L.tileLayer.wms('https://gdi.berlin.de/services/wms/berlinermauer?', {
			layers: 'e_luftbilder1989'
		});

		// 2b) Add backggroud map: DOPs
		var luftbilder2024 = L.tileLayer.wms('https://gdi.berlin.de/services/wms/truedop_2024?', {
			layers: 'truedop_2024'
		}).addTo(map);


		// 2c) Add backggroud map: OSM
		var osm = L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
			maxZoom: 19,
			attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
		}).addTo(map);



		var baseMaps = {
			"Luftbilder 1989": luftbilder1989,
			"Openstreetmap": osm,
			"Digitale farbige TrueOrthophotos 2024 (DOP20RGBI)": luftbilder2024
		};
		var layerControl = L.control.layers(baseMaps).addTo(map);


		// 3 a) Fetch GeoJSON (WFS Verlauf Berliner Mauer)
		const geometry = JSON.parse({{ geometry| tojson | safe }});


		// Von Co-Pilot
		// Get DOM elements

		L.geoJSON(geometry, {
			// You can add style options here if needed
			style: {
				color: "#ff7800",
				weight: 2,
				opacity: 0.65
			}
		}).addTo(map);


		// 4 Query Flickr API with draggable marker
		function onMapClick(e) {

			// https://gis.stackexchange.com/questions/80306/leaflet-draggable-marker 
			// & buffer: https://stackoverflow.com/questions/28867243/turf-buffer-and-a-draggable-marker
			marker = new L.marker(e.latlng, 
				{ draggable: 'true' });
			
				marker.on('dragend', function (event) {
				var marker = event.target;
				var position = marker.getLatLng();
				marker.setLatLng(new L.LatLng(position.lat, position.lng), { draggable: 'true' });
				map.panTo(new L.LatLng(position.lat, position.lng))
				
												
			});
			map.addLayer(marker);

			map.on("moveend", function () {
				var buffered = turf.buffer(marker.toGeoJSON(), 0.2, { units: "miles" });
				L.geoJSON(buffered).addTo(map);
			});

				
			//var position = marker.getLatLng();
			//console.log(position.lat, position.lng);
		


			//var url = `https://api.flickr.com/services/rest/?method=flickr.photos.search&api_key=aef635a622e9a3e2d5e2c519481331dd&lat=${lat}&lon=${lng}&radius=0.2&max_taken_date=1995-01-01&tag=mauer,wall&format=json&nojsoncallback=1`

			//console.log(url);
			// https://www.sitepoint.com/jquery-read-text-file/
			jQuery.get('/static/data/flickr_api.geojson', function (data) {

				// too much to disply
				//L.geoJSON(data).addTo(map);	


			});




			/*
			$.getJSON(url, function(data){
				//console.log(JSON.stringify(data));
				
				for (let i = 0; i < data.photos.photo.length; i++) {
					console.log(data.photos.photo[i].title);

					// https://developer.mozilla.org/en-US/docs/Web/API/HTMLImageElement/Image
					// Concat von Copilot
					const myImage = new Image();
					myImage.src = `https://live.staticflickr.com/${data.photos.photo[i].server}/${data.photos.photo[i].id}_${data.photos.photo[i].secret}_c.jpg`;
				
					document.body.appendChild(myImage);
				

				}

			} 
			
);*/
		}



		map.once('click', onMapClick);

		{% endblock %}

	</script>


	<!--
	<h2><div id="galleryTitle"></div></h2>
	<div style="clear:both;"/>
	<div id="flickr"/>
	-->


</body>

</html>